import requests as rq

# Retrieve all users from canvas, assuming token is admin level
def fetch_all_users(headers, account_id=1):
    base_url = f"https://canvas.instructure.com/api/v1/accounts/{account_id}/users"
    all_users = []
    params = {"per_page": 100}
    
    while base_url:
        response = rq.get(base_url, headers=headers, params=params)
        
        if response.status_code == 200:
            data = response.json()
            all_users.extend(data)
            
            # Handle pagination
            if 'next' in response.links:
                base_url = response.links['next']['url']
            else:
                base_url = None
        else:
            print(f"Error {response.status_code}: {response.text}")
            break

    return all_users

# Main
if __name__ == "__main__":
    headers = {
        "Authorization": "Bearer 7~I922O0TAC0vKRh89bhZp36BzuzhLIpFnQ7bQlA8j2ZokvGVI1kplOD7m1cpII3Oo"
    }

    users = fetch_all_users(headers)
    
    for user in users:
        print(f"ID: {user['id']}, Name: {user['name']}, Email: {user.get('email', 'N/A')}")
